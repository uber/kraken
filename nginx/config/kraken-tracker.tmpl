proxy_cache_path /tmp/nginx/kraken-tracker-metainfo-cache levels=1:2 keys_zone=metainfo:10m max_size=256g;

upstream tracker {
  server unix:/var/run/udocker/kraken-tracker.sock;
}

server {
  listen {{.port}};

  access_log /var/log/udocker/kraken/nginx-access.log;
  error_log /var/log/udocker/kraken/nginx-error.log;

  location / {
    proxy_pass http://tracker;
  }

  location ~* ^/namespace/.*/blobs/.*/metainfo$ {
    proxy_pass http://tracker;

    proxy_cache         metainfo;
    proxy_cache_methods GET;
    proxy_cache_valid   200 5m;
    proxy_cache_valid   any 1s;
    proxy_cache_lock    on;
  }
}
